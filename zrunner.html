<html>
<head>
<style>
.tile {
	position:fixed;
	z-index:-100;
}
#northWall {
	background-color:yellow;
}
#eastWall {
	background-color:orange;
}
#southWall {
	background-color:red;
}
#westWall {
	background-color:purple;
}
#corner {
	background-color:black;
}
#floor {
	background-color:#D6D6D6;
}


.door {
	position:fixed;
	z-index:-50;
}
#normalDoor {
	background-color:blue;
}

.playerSprite {
	z-index:100;
	background-color:green;
	position:fixed;
	float:left, top;
	outline:1;
}

.menu {
	float:left, top;
	z-index:500;
	display:none;
	background-color:black;
	color:white;
}

</style>
<script language="JavaScript">
</script>
<!--script src="https://rawgithub.com/dmauro/Keypress/master/keypress.js"></script-->
<script src="../keypress/keypress.js"></script>
<script src="Repeatable.js"></script>
</head>
<body>

<script language="JavaScript">
var TILE_SIZE = 25;
var PLAYER_X = 0;
var PLAYER_Y = 0;
var movingTimer = undefined;

function coordToPixel(coord) {
	return coord * TILE_SIZE;
}

function drawPlayer(x, y) {
	document.getElementById("player").style["top"] = coordToPixel(y);
	document.getElementById("player").style["left"] = coordToPixel(x);
}

function initPlayMenu() {
	document.write("<div class=\"menu\" id=\"playMenu\">Menu</div>")
}

function showPlayMenu() {
	document.getElementById("playMenu").style["display"] = "block";
}

function hidePlayMenu() {
	document.getElementById("playMenu").style["display"] = "none";
}

function initPlayer(x, y) {
	var xPixels = coordToPixel(x);
	var yPixels = coordToPixel(y);
	// make initial player
	document.write("<div class=\"playerSprite\" id=\"player\" style=\"top:", yPixels, "px; left:", xPixels, "px; width:", TILE_SIZE, "px; height:", TILE_SIZE, "px;\"></div>")
}

function drawCorner(x, y) {
	var xPixels = coordToPixel(x);
	var yPixels = coordToPixel(y);
	document.write("<div class=\"tile\" id=\"corner\" style=\"top:", yPixels, "px; left:", xPixels, "px; width:", TILE_SIZE, "px; height:", TILE_SIZE, "px;\"></div>")
}

function drawWall(x, y, direction) {
	var xPixels = coordToPixel(x);
	var yPixels = coordToPixel(y);
	document.write("<div class=\"tile\" id=\"", direction, "Wall\" style=\"top:", yPixels, "px; left:", xPixels, "px; width:", TILE_SIZE, "px; height:", TILE_SIZE, "px;\"></div>")
}

function drawFloor(x, y) {
	var xPixels = coordToPixel(x);
	var yPixels = coordToPixel(y);
	document.write("<div class=\"tile\" id=\"floor\" style=\"top:", yPixels, "px; left:", xPixels, "px; width:", TILE_SIZE, "px; height:", TILE_SIZE, "px;\"></div>")
}

function drawHorizontalDoor(x, y, doorSize) {
	var xPixels = coordToPixel(x);
	var yPixels = coordToPixel(y);
	var doorPixels = doorSize * TILE_SIZE;
	document.write("<div class=\"door\" id=\"normalDoor\" style=\"top:", yPixels, "px; left:", xPixels, "px; width:", doorPixels, "px; height:", TILE_SIZE, "px;\"></div>")
}

function drawVerticalDoor(x, y, doorSize) {
	var xPixels = coordToPixel(x);
	var yPixels = coordToPixel(y);
	var doorPixels = doorSize * TILE_SIZE;
	document.write("<div class=\"door\" id=\"normalDoor\" style=\"top:", yPixels, "px; left:", xPixels, "px; width:", TILE_SIZE, "px; height:", doorPixels, "px;\"></div>")
}

function drawNorthWall(startY, totalWidth) {
	var wallTiles = totalWidth - 2;
	var x = 0;

	drawCorner(x, startY);
	for (var i = 0; i < wallTiles; i++) {
		x++;
		drawWall(x, startY, "north");
	}
	x++;
	drawCorner(x, startY, TILE_SIZE);
}

function drawSouthWall(startY, totalWidth) {
	var wallTiles = totalWidth - 2;
	var x = 0;

	drawCorner(x, startY);
	for (var i = 0; i < wallTiles; i++) {
		x++;
		drawWall(x, startY, "south");
	}
	x++;
	drawCorner(x, startY);
}

function drawRoomRow(startY, totalWidth) {
	var floorTiles = totalWidth - 2;
	var x = 0;
	drawWall(x, startY, "west");
	for (var i = 0; i < floorTiles; i++) {
		x++;
		drawFloor(x, startY);
	}
	x++;
	drawWall(x, startY, "east");
}

function drawRoom() {
	var totalWidth = 12;
	var totalHeight = 12;
	var totalFloorRows = totalHeight - 2;
	var y = 0;

	drawNorthWall(y, totalWidth);

	for (var j = 0; j < totalFloorRows; j++) {
		y++;
		drawRoomRow(y, totalWidth);
	}

	y++;

	drawSouthWall(y, totalWidth);

	drawHorizontalDoor(3, y, 4);
	drawVerticalDoor((totalWidth - 1), (totalHeight / 2), 2);

	PLAYER_X = (totalWidth / 2);
	PLAYER_Y = (totalHeight / 2);
	initPlayer(PLAYER_X, PLAYER_Y);
	initPlayMenu();
}

var MOVE_FRACTION = .10;
var MOVE_INTERVAL_MS = 50;

function playerMoveUp() {
	PLAYER_Y -= MOVE_FRACTION;
	drawPlayer(PLAYER_X, PLAYER_Y);
}

function playerMoveDown() {
	PLAYER_Y += MOVE_FRACTION;
	drawPlayer(PLAYER_X, PLAYER_Y);
}

function playerMoveLeft() {
	PLAYER_X -= MOVE_FRACTION;
	drawPlayer(PLAYER_X, PLAYER_Y);
}

function playerMoveRight() {
	PLAYER_X += MOVE_FRACTION;
	drawPlayer(PLAYER_X, PLAYER_Y);
}

function registerKeyBoard() {
	var upMover = new Repeatable(playerMoveUp, MOVE_INTERVAL_MS);
	var downMover = new Repeatable(playerMoveDown, MOVE_INTERVAL_MS);
	var leftMover = new Repeatable(playerMoveLeft, MOVE_INTERVAL_MS);
	var rightMover = new Repeatable(playerMoveRight, MOVE_INTERVAL_MS);
	keypress.register_many([
		{
			"keys"		: "up",
			"on_keydown"	: function() { upMover.start(); },
			"on_keyup"	: function() { upMover.stop(); }
		},
		{
			"keys"		: "down",
			"on_keydown"	: function() { downMover.start(); },
			"on_keyup"	: function() { downMover.stop(); }
		},
		{
			"keys"		: "left",
			"on_keydown"	: function() { leftMover.start(); },
			"on_keyup"	: function() { leftMover.stop(); }
		},
		{
			"keys"		: "right",
			"on_keydown"	: function() { rightMover.start(); },
			"on_keyup"	: function() { rightMover.stop(); }
		},
		{
			"keys"		: "m",
			"on_keydown"	: function() { showPlayMenu(); },
			"on_keyup"	: function() { hidePlayMenu(); }
		}

	]);
}

function main() {
	registerKeyBoard();
	drawRoom();
}

main();
</script>

<!--
<div class="tile" id="corner" style="top:0px; left:0px; width:25px; height:25px;"></div>
<div class="tile" id="northWall" style="top:0px; left:25px; width:25px; height:25px;"></div>
<div class="tile" id="northWall" style="top:0px; left:50px; width:25px; height:25px;"></div>
<div class="tile" id="corner" style="top:0px; left:75px; width:25px; height:25px;"></div>
<div class=northwall style="width=25px height=25px left:25px top:0px"></div>
<div class=northWall style="width=26px height=25px left:50px top:0px"></div>
<div id=corner width=25px height=25px left:75px top:0px></div>
<div id=westWall width=25px height=25px left:0px top:25px></div>
<div id=floor width=25px height=25px left:25px top:25px></div>
<div id=floor width=25px height=25px left:50 top:25px></div>
<div id=eastWall width=25px height=25px left:75 top:25px></div>
<div id=corner width=25px height=25px left:0px top:50px></div>
<div id=southWall width=25px height=25px left:25px top:50px></div>
<div id=southWall width=25px height=25px left:50px top:50px></div>
<div id=corner width=25px height=25px left:75px top:50px></div>
-->

</body>
</html>
